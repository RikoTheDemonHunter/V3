repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- GUI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SafeZoneGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0,160,0,50)
toggleButton.Position = UDim2.new(0.05,0,0.2,0)
toggleButton.Text = "Toggle SafeZone"
toggleButton.BackgroundColor3 = Color3.fromRGB(30,30,30)
toggleButton.TextColor3 = Color3.fromRGB(255,255,255)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 20
toggleButton.Draggable = true
toggleButton.Active = true
toggleButton.Parent = screenGui

-- RGB text effect
local function RGBEffect(label)
	task.spawn(function()
		while label and label.Parent do
			for hue=0,255,4 do
				if label and label.Parent then
					label.TextColor3 = Color3.fromHSV(hue/255,1,1)
					task.wait(0.05)
				end
			end
		end
	end)
end

-- Tracking tables
local playersInsideSafe = {}
local playersUsingHub = {}

-- Ensure leaderstats
local function ensureLeaderstats(plr)
	if not plr:FindFirstChild("leaderstats") then
		local leaderstats = Instance.new("Folder")
		leaderstats.Name = "leaderstats"
		leaderstats.Parent = plr

		local insideSafeStat = Instance.new("IntValue")
		insideSafeStat.Name = "InsideSafe"
		insideSafeStat.Value = 0
		insideSafeStat.Parent = leaderstats

		local usingHubStat = Instance.new("IntValue")
		usingHubStat.Name = "UsingAveryHub"
		usingHubStat.Value = 0
		usingHubStat.Parent = leaderstats
	end
end

for _,plr in pairs(Players:GetPlayers()) do
	ensureLeaderstats(plr)
end
Players.PlayerAdded:Connect(ensureLeaderstats)

local function updateStats(plr)
	if not plr or not plr:FindFirstChild("leaderstats") then return end
	local insideSafe = plr.leaderstats:FindFirstChild("InsideSafe")
	local usingHub = plr.leaderstats:FindFirstChild("UsingAveryHub")
	if insideSafe then insideSafe.Value = playersInsideSafe[plr.Name] and 1 or 0 end
	if usingHub then usingHub.Value = playersUsingHub[plr.Name] and 1 or 0 end
end

local safeZoneFolder = nil
local running = false

-- Create SafeZone
local function createSafeZone()
	if safeZoneFolder then return end
	safeZoneFolder = Instance.new("Folder")
	safeZoneFolder.Name = "SafeZone"
	safeZoneFolder.Parent = workspace

	local baseplateY = 5
	local safeSpotRadius = 50
	local safeSpotHeight = 20

	-- Baseplate
	local baseplateWidth = 800
	local baseplateDepth = 600
	local baseplate = Instance.new("Part")
	baseplate.Size = Vector3.new(baseplateWidth,10,baseplateDepth)
	baseplate.Position = Vector3.new(0,baseplateY,-300)
	baseplate.Anchored = true
	baseplate.Material = Enum.Material.Grass
	baseplate.BrickColor = BrickColor.new("Bright green")
	baseplate.Parent = safeZoneFolder

	-- Circular Safe Spot
	local safeSpot = Instance.new("Part")
	safeSpot.Shape = Enum.PartType.Cylinder
	safeSpot.Size = Vector3.new(safeSpotRadius*2,safeSpotHeight,safeSpotRadius*2)
	safeSpot.Position = Vector3.new(0,baseplateY + 10 + safeSpotHeight/2,0)
	safeSpot.Anchored = true
	safeSpot.CanCollide = false
	safeSpot.Transparency = 0.4
	safeSpot.BrickColor = BrickColor.new("Bright blue")
	safeSpot.Material = Enum.Material.Neon
	safeSpot.Name = "AverySafeSpot"
	safeSpot.Parent = safeZoneFolder

	-- Floating Safe Zone Text
	local floatingSign = Instance.new("BillboardGui")
	floatingSign.Adornee = safeSpot
	floatingSign.Size = UDim2.new(0,200,0,50)
	floatingSign.AlwaysOnTop = true
	floatingSign.Parent = safeSpot

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1,0,1,0)
	label.BackgroundTransparency = 1
	label.Text = "Avery Safe Zone"
	label.TextScaled = true
	label.Font = Enum.Font.GothamBold
	label.TextColor3 = Color3.fromRGB(0,255,0)
	label.Parent = floatingSign
	RGBEffect(label)

	-- Path
	local path = Instance.new("Part")
	path.Size = Vector3.new(100,10,300)
	path.Position = Vector3.new(0,baseplateY + 5,-150)
	path.Anchored = true
	path.Material = Enum.Material.Concrete
	path.BrickColor = BrickColor.new("Medium stone grey")
	path.Parent = safeZoneFolder

	-- Front Sign
	local frontSign = Instance.new("Part")
	frontSign.Size = Vector3.new(200,50,5)
	frontSign.Position = Vector3.new(0,baseplateY + 15,-baseplateDepth/2 - 50)
	frontSign.Anchored = true
	frontSign.Material = Enum.Material.SmoothPlastic
	frontSign.Color = Color3.fromRGB(255,20,147)
	frontSign.Parent = safeZoneFolder

	local frontBillboard = Instance.new("BillboardGui")
	frontBillboard.Size = UDim2.new(0,200,0,50)
	frontBillboard.AlwaysOnTop = true
	frontBillboard.Adornee = frontSign
	frontBillboard.Parent = frontSign

	local frontLabel = Instance.new("TextLabel")
	frontLabel.Size = UDim2.new(1,0,1,0)
	frontLabel.BackgroundTransparency = 1
	frontLabel.Text = "Made by Avery Discord: 90averyxx"
	frontLabel.TextScaled = true
	frontLabel.Font = Enum.Font.GothamBold
	frontLabel.TextColor3 = Color3.fromRGB(255,20,147)
	frontLabel.Parent = frontBillboard
	RGBEffect(frontLabel)

	-- Avatar Statue
	local character = player.Character or player.CharacterAdded:Wait()
	local statue = character:Clone()
	for _,part in pairs(statue:GetDescendants()) do
		if part:IsA("BasePart") then
			part.Anchored = true
			part.Material = Enum.Material.SmoothPlastic
			part.Reflectance = 0.3
		end
	end
	if statue.PrimaryPart then
		statue:SetPrimaryPartCFrame(CFrame.new(0,baseplateY + 15,-baseplateDepth/2))
	end
	statue.Parent = safeZoneFolder

	-- Safe Spot touch events
	safeSpot.Touched:Connect(function(hit)
		local char = hit.Parent
		if char and char:FindFirstChild("Humanoid") then
			local plr = Players:GetPlayerFromCharacter(char)
			if plr then
				playersInsideSafe[plr.Name] = true
				updateStats(plr)
				char.Humanoid.Health = char.Humanoid.MaxHealth
			end
		end
	end)
	safeSpot.TouchEnded:Connect(function(hit)
		local char = hit.Parent
		if char and char:FindFirstChild("Humanoid") then
			local plr = Players:GetPlayerFromCharacter(char)
			if plr then
				playersInsideSafe[plr.Name] = nil
				updateStats(plr)
			end
		end
	end)
end

-- Remove SafeZone
local function removeSafeZone()
	if safeZoneFolder and safeZoneFolder.Parent then
		safeZoneFolder:Destroy()
		safeZoneFolder = nil
	end
end

-- Toggle SafeZone
toggleButton.MouseButton1Click:Connect(function()
	local plr = Players.LocalPlayer
	if playersUsingHub[plr.Name] then
		playersUsingHub[plr.Name] = nil
	else
		playersUsingHub[plr.Name] = true
	end
	updateStats(plr)

	if running then
		removeSafeZone()
	else
		createSafeZone()
	end
	running = not running
end)
