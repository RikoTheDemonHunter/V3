-- Avery's SafeZone Full Script (Optimized Color Cycling)
repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

local safeZoneFolder = nil
local running = false
local safeZoneParts = {}

-- RGB effect function for billboard text
local function RGBEffect(label)
	if not label then return end
	task.spawn(function()
		while label and label.Parent do
			for hue=0,1,0.01 do
				if label and label.Parent then
					label.TextColor3 = Color3.fromHSV(hue,1,1)
					task.wait(0.05)
				end
			end
		end
	end)
end

-- Smooth color cycle for SafeZone walls and floor (Optimized)
local hueValue = 0
local function cycleColorOptimized(delta)
	if not running then return end
	hueValue = (hueValue + delta * 0.1) % 1
	local color = Color3.fromHSV(hueValue,0.7,1)
	for _,part in pairs(safeZoneParts) do
		if part and part.Parent then
			part.Color = color
		end
	end
end

-- Create SafeZone
local function createSafeZone()
	if safeZoneFolder then return end
	safeZoneFolder = Instance.new("Folder")
	safeZoneFolder.Name = "SafeZone"
	safeZoneFolder.Parent = workspace

	local cubeSize = 600
	local cubeHeight = 100
	local yPos = 3600
	local wallThickness = 20
	local entranceWidth = 100
	local pathWidth = 100
	local pathLength = 300
	local baseplateWidth = 800
	local baseplateDepth = 600

	-- Floor
	local floor = Instance.new("Part")
	floor.Size = Vector3.new(cubeSize,10,cubeSize)
	floor.Position = Vector3.new(0,yPos+5,0)
	floor.Anchored = true
	floor.Material = Enum.Material.SmoothPlastic
	floor.Transparency = 0.5
	floor.Reflectance = 0.2
	floor.Name = "Floor"
	floor.Color = Color3.fromRGB(0,0,255)
	floor.Parent = safeZoneFolder
	table.insert(safeZoneParts,floor)

	-- Walls
	local function createWall(position,size,orientation)
		local wall = Instance.new("Part")
		wall.Size = size
		wall.Position = position
		wall.Anchored = true
		wall.Material = Enum.Material.SmoothPlastic
		wall.Transparency = 0.4
		wall.Color = Color3.fromRGB(0,0,255)
		if orientation then wall.Orientation = orientation end
		wall.Parent = safeZoneFolder
		table.insert(safeZoneParts,wall)
		return wall
	end

	createWall(Vector3.new(-cubeSize/2,yPos+cubeHeight/2,0),Vector3.new(wallThickness,cubeHeight,cubeSize))
	createWall(Vector3.new(cubeSize/2,yPos+cubeHeight/2,0),Vector3.new(wallThickness,cubeHeight,cubeSize))
	createWall(Vector3.new(0,yPos+cubeHeight/2,cubeSize/2),Vector3.new(cubeSize,cubeHeight,wallThickness))

	-- Front wall split for entrance
	local frontLeft = Instance.new("Part")
	frontLeft.Size = Vector3.new((cubeSize-entranceWidth)/2,cubeHeight,wallThickness)
	frontLeft.Position = Vector3.new(-(cubeSize-entranceWidth)/4 - entranceWidth/2,yPos+cubeHeight/2,-cubeSize/2)
	frontLeft.Anchored = true
	frontLeft.Material = Enum.Material.SmoothPlastic
	frontLeft.Transparency = 0.4
	frontLeft.Color = Color3.fromRGB(0,0,255)
	frontLeft.Parent = safeZoneFolder
	table.insert(safeZoneParts,frontLeft)

	local frontRight = Instance.new("Part")
	frontRight.Size = Vector3.new((cubeSize-entranceWidth)/2,cubeHeight,wallThickness)
	frontRight.Position = Vector3.new((cubeSize-entranceWidth)/4 + entranceWidth/2,yPos+cubeHeight/2,-cubeSize/2)
	frontRight.Anchored = true
	frontRight.Material = Enum.Material.SmoothPlastic
	frontRight.Transparency = 0.4
	frontRight.Color = Color3.fromRGB(0,0,255)
	frontRight.Parent = safeZoneFolder
	table.insert(safeZoneParts,frontRight)

	-- Path
	local path = Instance.new("Part")
	path.Size = Vector3.new(pathWidth,10,pathLength)
	path.Position = Vector3.new(0,yPos+5,-cubeSize/2 - pathLength/2)
	path.Anchored = true
	path.Material = Enum.Material.Concrete
	path.Color = Color3.fromRGB(128,128,128)
	path.Parent = safeZoneFolder

	-- Wide Baseplate
	local baseplate = Instance.new("Part")
	baseplate.Size = Vector3.new(baseplateWidth,10,baseplateDepth)
	baseplate.Position = Vector3.new(0,yPos-5,-cubeSize/2 - pathLength - baseplateDepth/2)
	baseplate.Anchored = true
	baseplate.Material = Enum.Material.Grass
	baseplate.Color = Color3.fromRGB(0,255,0)
	baseplate.Parent = safeZoneFolder

	-- Floating "Made by Avery" billboard with RGB text
	local signPart = Instance.new("Part")
	signPart.Size = Vector3.new(200,50,5)
	signPart.Position = Vector3.new(0,yPos+60,-cubeSize/2 - pathLength - baseplateDepth/2)
	signPart.Anchored = true
	signPart.Material = Enum.Material.SmoothPlastic
	signPart.Color = Color3.fromRGB(255,0,255)
	signPart.Transparency = 0.7
	signPart.Parent = safeZoneFolder

	local billboard = Instance.new("BillboardGui")
	billboard.Size = UDim2.new(0,200,0,50)
	billboard.AlwaysOnTop = true
	billboard.Adornee = signPart
	billboard.Parent = signPart

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1,0,1,0)
	label.BackgroundTransparency = 1
	label.Text = "Made by Avery"
	label.TextScaled = true
	label.Font = Enum.Font.GothamBold
	label.TextTransparency = 0
	label.Parent = billboard

	-- Start RGB text effect
	RGBEffect(label)
end

-- Remove SafeZone
local function removeSafeZone()
	if safeZoneFolder and safeZoneFolder.Parent then
		safeZoneFolder:Destroy()
		safeZoneFolder = nil
		safeZoneParts = {}
	end
end

-- GUI Toggle
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SafeZoneGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0,160,0,50)
toggleButton.Position = UDim2.new(0.05,0,0.2,0)
toggleButton.Text = "Toggle SafeZone"
toggleButton.BackgroundColor3 = Color3.fromRGB(30,30,30)
toggleButton.TextColor3 = Color3.fromRGB(255,255,255)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 20
toggleButton.Draggable = true
toggleButton.Active = true
toggleButton.Parent = screenGui

toggleButton.MouseButton1Click:Connect(function()
	if running then
		removeSafeZone()
	else
		createSafeZone()
	end
	running = not running
end)

-- Connect optimized color cycle to RenderStepped (runs once per frame)
RunService.RenderStepped:Connect(function(deltaTime)
	if running then
		cycleColorOptimized(deltaTime)
	end
end)
