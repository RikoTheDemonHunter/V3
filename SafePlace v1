repeat task.wait() until game:IsLoaded()

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

local safeZoneFolder
local running = false
local safeZoneParts = {}
local shieldPart
local safeZoneCenter = Vector3.new(0,3600,0)
local safeZoneHalfExtents = Vector3.new(300,50,300)
local hueValue = 0
local colorSpeedMultiplier = 1
local baseSaturation = 0.7

local healEnabled = false
local shieldEnabled = true
local autoTeleportEnabled = false
local healRate = 5

-- RGB text effect
local function RGBEffect(label)
	if not label then return end
	task.spawn(function()
		while label and label.Parent do
			for h = 0,1,0.01 do
				if not (label and label.Parent) then break end
				label.TextColor3 = Color3.fromHSV(h,1,1)
				task.wait(0.05)
			end
		end
	end)
end

-- Smooth color cycle
local function updatePartsColor(dt)
	hueValue = (hueValue + dt * 0.1 * colorSpeedMultiplier) % 1
	local color = Color3.fromHSV(hueValue, baseSaturation, 1)
	for _, part in pairs(safeZoneParts) do
		if part and part.Parent then
			pcall(function() part.Color = color end)
		end
	end
end

-- Check if position is inside SafeZone
local function insideSafeZone(pos)
	if not safeZoneFolder then return false end
	local min = safeZoneCenter - safeZoneHalfExtents
	local max = safeZoneCenter + safeZoneHalfExtents
	return pos.X >= min.X and pos.X <= max.X
	   and pos.Y >= min.Y and pos.Y <= max.Y
	   and pos.Z >= min.Z and pos.Z <= max.Z
end

-- Create shield visual (invisible)
local function createShield(wSize)
	if shieldPart and shieldPart.Parent then shieldPart:Destroy() end
	shieldPart = Instance.new("Part")
	shieldPart.Shape = Enum.PartType.Ball
	shieldPart.Size = Vector3.new(wSize,wSize,wSize)
	shieldPart.Position = safeZoneCenter
	shieldPart.Anchored = true
	shieldPart.CanCollide = true
	shieldPart.Transparency = 1 -- invisible
	shieldPart.Parent = workspace
end

-- Create SafeZone
local function createSafeZone()
	if safeZoneFolder then return end
	safeZoneFolder = Instance.new("Folder")
	safeZoneFolder.Name = "SafeZone"
	safeZoneFolder.Parent = workspace

	local cubeSize = 600
	local cubeHeight = 100
	local yPos = 3600
	local entranceWidth = 100
	local pathWidth = 100
	local pathLength = 300
	local baseplateWidth = 800
	local baseplateDepth = 600

	safeZoneCenter = Vector3.new(0, yPos, 0)
	safeZoneHalfExtents = Vector3.new(cubeSize/2, cubeHeight/2, cubeSize/2)

	local floor = Instance.new("Part")
	floor.Size = Vector3.new(cubeSize,10,cubeSize)
	floor.Position = Vector3.new(0, yPos+5,0)
	floor.Anchored = true
	floor.Material = Enum.Material.SmoothPlastic
	floor.Transparency = 0.5
	floor.Reflectance = 0.2
	floor.Color = Color3.fromRGB(0,0,255)
	floor.Parent = safeZoneFolder
	table.insert(safeZoneParts, floor)

	local function createWall(pos, size)
		local wall = Instance.new("Part")
		wall.Size = size
		wall.Position = pos
		wall.Anchored = true
		wall.Material = Enum.Material.SmoothPlastic
		wall.Transparency = 0.4
		wall.Color = Color3.fromRGB(0,0,255)
		wall.Parent = safeZoneFolder
		table.insert(safeZoneParts, wall)
	end

	createWall(Vector3.new(-cubeSize/2,yPos+cubeHeight/2,0), Vector3.new(20,cubeHeight,cubeSize))
	createWall(Vector3.new(cubeSize/2,yPos+cubeHeight/2,0), Vector3.new(20,cubeHeight,cubeSize))
	createWall(Vector3.new(0,yPos+cubeHeight/2,cubeSize/2), Vector3.new(cubeSize,cubeHeight,20))

	local frontLeft = Instance.new("Part")
	frontLeft.Size = Vector3.new((cubeSize-entranceWidth)/2,cubeHeight,20)
	frontLeft.Position = Vector3.new(-(cubeSize-entranceWidth)/4 - entranceWidth/2, yPos+cubeHeight/2, -cubeSize/2)
	frontLeft.Anchored = true
	frontLeft.Material = Enum.Material.SmoothPlastic
	frontLeft.Transparency = 0.4
	frontLeft.Color = Color3.fromRGB(0,0,255)
	frontLeft.Parent = safeZoneFolder
	table.insert(safeZoneParts, frontLeft)

	local frontRight = Instance.new("Part")
	frontRight.Size = Vector3.new((cubeSize-entranceWidth)/2,cubeHeight,20)
	frontRight.Position = Vector3.new((cubeSize-entranceWidth)/4 + entranceWidth/2, yPos+cubeHeight/2, -cubeSize/2)
	frontRight.Anchored = true
	frontRight.Material = Enum.Material.SmoothPlastic
	frontRight.Transparency = 0.4
	frontRight.Color = Color3.fromRGB(0,0,255)
	frontRight.Parent = safeZoneFolder
	table.insert(safeZoneParts, frontRight)

	local path = Instance.new("Part")
	path.Size = Vector3.new(pathWidth,10,pathLength)
	path.Position = Vector3.new(0, yPos+5, -cubeSize/2 - pathLength/2)
	path.Anchored = true
	path.Material = Enum.Material.Concrete
	path.Color = Color3.fromRGB(128,128,128)
	path.Parent = safeZoneFolder

	local baseplate = Instance.new("Part")
	baseplate.Size = Vector3.new(baseplateWidth,10,baseplateDepth)
	baseplate.Position = Vector3.new(0, yPos-5, -cubeSize/2 - pathLength - baseplateDepth/2)
	baseplate.Anchored = true
	baseplate.Material = Enum.Material.Grass
	baseplate.Color = Color3.fromRGB(0,255,0)
	baseplate.Parent = safeZoneFolder

	local signPart = Instance.new("Part")
	signPart.Size = Vector3.new(200,50,5)
	signPart.Position = Vector3.new(0, yPos+60, -cubeSize/2 - pathLength - baseplateDepth/2)
	signPart.Anchored = true
	signPart.Material = Enum.Material.SmoothPlastic
	signPart.Color = Color3.fromRGB(255,0,255)
	signPart.Transparency = 0.7
	signPart.Parent = safeZoneFolder

	local billboard = Instance.new("BillboardGui")
	billboard.Size = UDim2.new(0,200,0,50)
	billboard.AlwaysOnTop = true
	billboard.Adornee = signPart
	billboard.Parent = signPart

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1,0,1,0)
	label.BackgroundTransparency = 1
	label.Text = "Made by Avery"
	label.TextScaled = true
	label.Font = Enum.Font.GothamBold
	label.TextTransparency = 0
	label.Parent = billboard

	RGBEffect(label)

	if shieldEnabled then
		createShield(600)
	end
end

local function removeSafeZone()
	if safeZoneFolder and safeZoneFolder.Parent then
		safeZoneFolder:Destroy()
		safeZoneFolder = nil
		safeZoneParts = {}
	end
	if shieldPart and shieldPart.Parent then
		shieldPart:Destroy()
		shieldPart = nil
	end
end

local function smoothTeleport(targetPos, duration)
	local char = player.Character
	if char then
		local root = char:FindFirstChild("HumanoidRootPart")
		if root then
			local tweenInfo = TweenInfo.new(duration or 0.6, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
			TweenService:Create(root, tweenInfo, {CFrame = CFrame.new(targetPos + Vector3.new(0,10,0))}):Play()
		end
	end
end

-- GUI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SafeZoneGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Always-visible toggle button
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0,40,0,40)
toggleButton.Position = UDim2.new(0,10,0,10)
toggleButton.Text = "â˜°"
toggleButton.Parent = screenGui
toggleButton.ZIndex = 10

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0,250,0,360)
mainFrame.Position = UDim2.new(0,60,0,10)
mainFrame.BackgroundColor3 = Color3.fromRGB(35,35,35)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

toggleButton.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
end)

-- Helper to create buttons
local function createButton(text, pos, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0,200,0,40)
	btn.Position = pos
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 18
	btn.Parent = mainFrame
	btn.MouseButton1Click:Connect(callback)
	return btn
end

-- SafeZone toggle
local toggleSafeZoneBtn
toggleSafeZoneBtn = createButton("SafeZone: OFF", UDim2.new(0,25,0,20), function()
	if running then
		removeSafeZone()
		toggleSafeZoneBtn.Text = "SafeZone: OFF"
	else
		createSafeZone()
		toggleSafeZoneBtn.Text = "SafeZone: ON"
	end
	running = not running
end)

-- Heal toggle
local toggleHealBtn
toggleHealBtn = createButton("Heal: OFF", UDim2.new(0,25,0,70), function()
	healEnabled = not healEnabled
	toggleHealBtn.Text = "Heal: "..(healEnabled and "ON" or "OFF")
end)

-- Shield toggle
local toggleShieldBtn
toggleShieldBtn = createButton("Shield: ON", UDim2.new(0,25,0,120), function()
	shieldEnabled = not shieldEnabled
	toggleShieldBtn.Text = "Shield: "..(shieldEnabled and "ON" or "OFF")
	if shieldEnabled and running then
		createShield(600)
	elseif shieldPart then
		shieldPart:Destroy()
	end
end)

-- Auto-Teleport toggle
local toggleAutoTPBtn
toggleAutoTPBtn = createButton("AutoTP: OFF", UDim2.new(0,25,0,170), function()
	autoTeleportEnabled = not autoTeleportEnabled
	toggleAutoTPBtn.Text = "AutoTP: "..(autoTeleportEnabled and "ON" or "OFF")
end)

-- RGB speed slider
local sliderLabel = Instance.new("TextLabel")
sliderLabel.Size = UDim2.new(0,200,0,30)
sliderLabel.Position = UDim2.new(0,25,0,220)
sliderLabel.Text = "RGB Speed: 1"
sliderLabel.BackgroundTransparency = 0.5
sliderLabel.BackgroundColor3 = Color3.fromRGB(50,50,50)
sliderLabel.TextColor3 = Color3.fromRGB(255,255,255)
sliderLabel.Font = Enum.Font.SourceSans
sliderLabel.TextSize = 16
sliderLabel.Parent = mainFrame

local slider = Instance.new("TextButton")
slider.Size = UDim2.new(0,200,0,20)
slider.Position = UDim2.new(0,25,0,250)
slider.BackgroundColor3 = Color3.fromRGB(100,100,100)
slider.Text = ""
slider.Parent = mainFrame

local dragging = false
slider.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
	end
end)
slider.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = false
	end
end)
slider.InputChanged:Connect(function(input)
	if dragging then
		local mouse = UserInputService:GetMouseLocation()
		local pos = math.clamp(mouse.X - slider.AbsolutePosition.X,0,slider.AbsoluteSize.X)
		colorSpeedMultiplier = pos/50
		sliderLabel.Text = "RGB Speed: "..string.format("%.1f", colorSpeedMultiplier)
	end
end)

-- Heartbeat logic
RunService.Heartbeat:Connect(function(dt)
	if running and not safeZoneFolder then
		createSafeZone()
	elseif not running and safeZoneFolder then
		removeSafeZone()
	end

	if healEnabled and player.Character and player.Character:FindFirstChild("Humanoid") then
		player.Character.Humanoid.Health = math.min(player.Character.Humanoid.MaxHealth, player.Character.Humanoid.Health + healRate * dt)
	end

	if shieldEnabled and safeZoneFolder and player.Character and player.Character:FindFirstChild("Humanoid") then
		local hum = player.Character.Humanoid
		if hum.Health < hum.MaxHealth then
			hum.Health = hum.MaxHealth
		end
	end
end)

RunService.RenderStepped:Connect(function(dt)
	if running then
		updatePartsColor(dt)
	end
end)

RunService.Heartbeat:Connect(function()
	if running and autoTeleportEnabled then
		local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
		local hum = player.Character and player.Character:FindFirstChild("Humanoid")
		if root and hum and hum.Health > 0 and not insideSafeZone(root.Position) then
			smoothTeleport(safeZoneCenter,0.6)
		end
	end
end)
